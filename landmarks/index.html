<!DOCTYPE html>

<html>

<head>
  <meta charset="utf-8">
	<script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?sensor=true"></script>
  <title>Assignemnt 2</title>

  <link rel="stylesheet" href="style.css">
</head>

<body onload="initMap()">
<div id="map"> MAP </div>

<script>

var myLat = 0;
var myLng = 0;
var me = new google.maps.LatLng(myLat, myLng);
var map; 
var myOptions = {
						zoom: 13, // The larger the zoom number, the bigger the zoom
						center: me,
						mapTypeId: google.maps.MapTypeId.ROADMAP
					};
var marker;
var infowindow = new google.maps.InfoWindow();

function initMap(){
        map = new google.maps.Map(document.getElementById("map"), myOptions); 
        getLocation();
      }


function getLocation(){
	console.log("test!"); 

	if (navigator.geolocation) { // the navigator.geolocation object is supported on your browser
					//get location and pass it to a function? 
					navigator.geolocation.getCurrentPosition(function(position) {
						myLat = position.coords.latitude;
						myLng = position.coords.longitude;
						//for testing purposes output it
						renderMap(); 
					});
				}
				else {
					alert("Geolocation is not supported by your web browser.  What a shame!");
				}
}


function sendLocation(){


	var myRequest = new XMLHttpRequest();
	 	myRequest.open("Post", "https://defense-in-derpth.herokuapp.com/sendLocation", true);
	 	myRequest.setRequestHeader("Content-type", "application/x-www-form-urlencoded"); 
	 	//convention on assignment sheet


		myRequest.onreadystatechange = function (){

	 		//data must be ready 
	 		if (myRequest.readyState == 4 && myRequest.status == 200) {

	 			//check if the data is bad
	 			result=""; 
	 			raw = myRequest.responseText;
	 			theData = JSON.parse(raw);
	 			//elem = document.getElementById("messages");
	 			//elem.innerHTML = theData; 
	 			console.log(theData); 


	 			console.log(theData.people.length); 
				for(i=0; i<theData.people.length; i++){
					console.log("looping"); 
					console.log("testing data array");
					 longin = theData.people[i].login; 
					 LatLng = {lat: theData.people[i].lat, lng: theData.people[i].lng};
			

					 var marker = new google.maps.Marker({
						position: LatLng,
						title: "Here I Am!"
					});
					
					marker.setMap(map);
									
								/* // Open info window on click of marker
								google.maps.event.addListener(marker, 'click', function() {
									infowindow.setContent(marker.title);
									infowindow.open(map, marker);
								});
					 			} */ 

	 			}
	 	}

	 	
	}

	myRequest.send("login=ELMER_MADDEN&lat="+myLat+"&lng="+myLng); 
	 console.log("theoretically, you sent your location!");  
}

function renderMap(){
		me = new google.maps.LatLng(myLat, myLng);
		map.panTo(me);
        marker = new google.maps.Marker({
					position: me,
					title: "Here I Am!"
				});

				marker.setMap(map);
					
				// Open info window on click of marker
				google.maps.event.addListener(marker, 'click', function() {
					infowindow.setContent(marker.title);
					infowindow.open(map, marker);
				});
				sendLocation(); 
}

</script>


 
</body>

</html>